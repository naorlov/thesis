\documentclass[a4paper,12pt]{article}

\usepackage{cmap}                   % Поиск по кириллице
\usepackage{mathtext}               % Кириллица в формулах
\usepackage[T1,T2A]{fontenc}        % Кодировки шрифтов
\usepackage[utf8]{inputenc}         % Кодировка текста
\usepackage[english,russian]{babel} % Подключение поддержки языков

\usepackage{header}
\usepackage{hyperref}

 % Цвета для гиперссылок
\usepackage{xcolor}
\usepackage{floatflt}
\usepackage{ulem}

% hack for indentation
\usepackage{indentfirst}
\usepackage{longtable}
\usepackage{graphicx}

\usepackage{chngcntr}
\counterwithin{figure}{section}
\counterwithin{table}{section}

\usepackage{caption}
\captionsetup[table]{position=t,justification=raggedleft,slc=off}

% hack for список литературы
\usepackage{etoolbox}
\patchcmd{\thebibliography}{\section*}{\section}{}{}
\fancyhf{}
\fancyhead[R]{\head}
\fancyhead[L]{\thepage}

\def\baselinestretch{1}

\makeatletter
\let\newtitle\@title \let\newdate\@date
\makeatother

\linespread{1.5}

\usepackage[backend=bibtex, sorting=none]{biblatex}

\addbibresource{bibliography.bib}

\newcommand*{\TODO}[1]{{\color{red}{TODO: \textit{#1}}}}

\begin{document}
    \input{sections/report_titlepage.tex}
    \newpage
    \tableofcontents
    \newpage
    
    \section{Введение}

    В современном мире MapReduce является основным фреймворком для обработки
    больших объемов данных -- гораздо больших, чем может обработать один
    компьютер. Представленная компанией Google статья \cite{google_mapreduce}
    2004 года подробно рассказывает о внутренней архитектуре такой системы. 

    Год к году количество производимых человечеством данных растет, что влечет
    за собой появление все большего количества кластеров по обработке данных. Но
    цена постройки таких кластеров высока -- стоимость ЦОД может достигать
    десятков миллионов долларов. Поэтому многие технологические компании хотят
    иметь возможность проводить симуляции своих вычислений с целью получения 
    информации о необходимой архитектуре кластера для эффективного использования 
    доступных средств.

    \section{Внутреннее устройство MapReduce}

    Система MapReduce основана на очень простой идее -- разбиение обработки
    данных на две стадии, называемые Map и Reduce. 

    Map-шаг выполняет предварительную обработку данных, разбивая входные данные
    на пары (ключ, значение). Reduce-шаг выполняет агрегацию значений с
    одинаковым ключом. В своей статье авторы предлагают несколько примеров
    задач, решаемых в парадигме MapReduce. Одним из примеров является задача
    подсчета количества слов в тексте.

    \section{Цели и задачи}

    В рамках данной практики передо мной были поставлены следующие задачи:

    \begin{enumerate}
        \item Реализация симулятора MapReduce кластера
        \item Реализация алгоритмов анализа данных времени выполнения и
        потребленной памяти MapReduce программой
    \end{enumerate}

    Поставленная задача предполагает получение модели, позволяющей моделировать
    время исполнения определенной пользователем MapReduce-задачи на
    предоставленном пользователем кластере.

    \section{Симуляция распределенных систем}

    \textit{Примечание: здесь и далее термины <<симуляция>> и <<имитацонное моделирование>> являются взаимозаменяемыми.}

    На данный момент распространенными технологиями симуляции распределенных
    систем являются несколько классов систем.

    \subsection{Дискретно-событийное моделирование}

    \textit{Дискретно-событийным моделированием} называется технология
    моделирования, при которой поведение системы во времени представляется в
    виде отдельных \textit{событий}, меняющих состояние системы,
    параметризованных временем. Во время моделирования строится
    последовательность событий, представляющая из себя все изменения состояния
    системы. Приведем пример в виде стандартного HTTP-сервера: обработка запроса
    состоит из следующих событий:

    \begin{enumerate}
        \item Получение запроса от пользователя
        \item Подготовка обработчика запроса
        \item Обработка запроса
        \item Возврат ответа пользователю
    \end{enumerate}

    В таких системах присутствует (обычно) разделяемое \textit{состояние},
    которое обновляется во времени в соответствии с событиями. 

    Преимуществом дискретно-событийного моделирования является относительная
    простота реализации. Например, систему можно представить в виде конечного
    автомата.

    \subsection{Аналитическое моделирование}

    \textit{Аналитическим моделированием} называется набор подходов к
    моделированию систем, предполагающий создание математического описания
    системы, позволяющего вычислить состояние этой системы. Ярким примером
    такого моделирования являются физические системы, описываемые набором
    дифференциальных уравнений. 


    \section{Существующие симуляторы}

    Среди симуляторов распределенных систем можно найти представителей разных
    подходов к моделированию. 

    Достаточно распространненым приемом является применение \textit{акторной
    модели}. Здесь вся система разбивается на \textit{акторы} -- небольшие части
    системы, осуществляющие взаимодействие между друг другом, чья совокупная
    работа является результатом работы реальной системы. В контексте симуляции
    MapReduce вычислений акторами могут являтся вычислительные узлы системы,
    осуществующие исполнение стадий MapReduce-задач. Примером такого симулятора
    является YarnSim \cite{yarnsim}. Построенный на основе фреймворка для
    акторного моделирования SimGrid \cite{simgrid}, по заявлениям авторов, может
    достигать точности (разницы между реальным и предсказанным временем работы)
    в 10\%. 


    
    \section{Используемый подход}
    
    В симуляции используется комбинированный подход: сначала программа проходит
    тест производительности, во время которого происходит нахождение лучшей
    модели, описывающей время работы программы относительно размера входных
    данных, после чего запускается симуляция с параметрами, указанными
    пользователем. Рассмотрим подорбнее оба шага.

    \subsection{Конфигурация}

    Работа с системой начинается с построения конфигурации программы. Для
    корректной работы пользователь должен предоставить конфигурационный файл,
    описывающий MapReduce-задачу: шаги задачи, входные и выходные данные для
    каждого шага, а также исполняемый файл, необходимый для запуска этого шага. 

    \subsection{Тестирование}

    На основании информации из конфигурационного файла проводится тестирование
    шагов MapReduce-задачи. Результатом тестирования является модель времени
    исполнения и объем выходных данных шага задачи.

    Каждый шаг запускается несколько раз на каждом входном файле, которые
    указаны в конфигурационном файле (по умолчанию 10), после чего считается
    среднее значение среди 95-перцентиля всех значений. Это позволяет избавиться
    от выбросов в данных, которые неизбежно появляются из-за особенностей работы
    операционной системы. В итоге получается набор точек $(n_i, t_i)$, где $n_i$
    -- размер входных данных в строках, $t_i$ -- время исполнения шага,
    отвечающее соответствующему размеру входных данных.
    
    Затем происходит поиск подходящей модели. Для уменьшения пространства поиска
    модели рассматриваются только модели из следующего семейства функций:
    
    \begin{equation} 
        f(n) = \sum_{i = 0}^d a_in^i + \sum_{i=0}^d b_in^i\log(n)
    \end{equation} 

    Здесь параметризация семейства идет по параметру $d$ -- степени линейной
    части. $n$ является количеством входных строк. Для всех значений $d$ вплоть
    до верхнего предела, указанного пользователем (по умолчанию 10) происходит
    регрессия времени исполнения на коэффициенты $a_i, b_i$. 
    
    Результатом работы этого этапа симуляции является текстовый файл с описанием
    функций времени исполнения и выходных данных для каждого шага
    MapReduce-задачи.

    \subsection{Симуляция}

    Симулятор построен на базе фреймворка SimGrid \cite{simgrid}, позволяющего с
    легкостью описать распределенную систему в акторной модели. Симулятор
    работает с конфигурационным файлом, полученным от пользователя, файлом
    описания платформы и файлом результатов тестирования, полученным на этапе
    тестирования. 

    Для каждого шага симулятор создает <<задание>> на исполнение, состоящее из
    объема входных данных, функции зависимости времени выполнения и объема
    выходных данных для этого шага. Затем, для каждого сервера в эмулируемом
    кластере создается свой актор, ответственный за работу этого узла кластера.

    Каждый актор использует вызовы фреймворка SimGrid для симуляции исполнения
    шага MapReduce-задачи на узле, а именно чтение данных из файловой системы,
    выполнение программы и запись данных в файловую систему.

    На текущем этапе развития дипломной работы, симулятор способен предсказывать
    время выполнения MapReduce задачи на одном сервере, а также на наборе
    серверов, при условии равного разделения работы между серверами. 

    \section{Результаты}

    По итогам написания был проведен тест симуляции. Для этого была реализована
    программа для подсчета количества слов в текстовом корпусе. В качестве
    входных данных были взяты тексты из Википедии. Обучение моделей
    производилось на файлах со следующим количеством строк: 

    \begin{equation}
        1956, 4253, 12016, 32351, 635443, 7297119
    \end{equation}
    
     Тесты
    проводились на сервере со следующими характеристиками: 6-core@2.1GHZ Intel
    Core i7 Gen9, 12 GB RAM. 

    \begin{table}[htbp]
    \begin{center}
    \begin{tabular}{c|c|c|c|c|c}
        Размер входа              & 100   & 1000  & 10000 & 100000 & 1000000 \\
        Время работы MAP (реал)   & 0.010 & 0.013 & 0.020 & 0.208  & 3.079   \\
        Время работы MAP (пред)   & 0.009 & 0.013 & 0.020 & 0.172  & 2.824   \\
        Время работы RED (реал)   & 0.010 & 0.032 & 0.056 & 1.669  & 26.013  \\
        Время работы RED (пред)   & 0.049 & 0.047 & 0.052 & 1.997  & 29.898  \\
        Разница MAP               & 10\%  & 0 \%  & 0\%   & 17\%   & 12\%    \\
        Разница RED               & 390\% & 31\%  & 7\%   & 19\%   & 14\%    \\
    \end{tabular}

    \medskip
    \catption{Рис 1. Результаты тестирования}
    \end{center}
    \end{table}

    В таблице выше все времена представлены в секундах, размер входа -- в
    количестве строк. Разница считается по следующей формуле:

    \begin{equation}
        \text{\textit{difference}} = \frac{|t_{real} - t_{pred}|}{t_{real}}
    \end{equation}
    
    где $ t_{real} $ -- реальное время работы, $ t_{pred} $ -- предсказанное
    время работы.
    
    По итогам тестирования видно чрезвычайно большой разброс на маленьком
    количестве строк и умеренный разброс на количестве строк, лежащем в том же
    диапазоне, что и обучающая выборка, что говорит нам о необходимости
    проводить более тщательную работу с данными во время обучения.

    По итогам практики были созданы симулятор MapReduce кластера, способный на
    симуляцию исполнения задач в случае равномерного распределения входных
    данных по узлам, и система анализа времени исполнения и объема выходных
    данных MapReduce программы, делающая возможным проведение симуляций
    различных MapReduce задач.

    \section{Выводы}

    Симуляция распределенных систем явялется удобным инструментом для
    исследования различных систем и алгоритмов в случае отсутствия реального
    кластера или денег на его постройку.

    \newpage
    \printbibliography
\end{document}
